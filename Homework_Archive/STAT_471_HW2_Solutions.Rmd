---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

### Homework 2 Solutions

### Problem 1

```{r}

# Simulating 30 random variables that follow a normal distribution. Note that you'll need to create a variable that stores the variance.

set.seed(42)

norm_nums = rnorm(30, mean=10, sd=6)
var_nums = 36 # 6^2 = 36
n = length(norm_nums)

score = function(mu, sigma2, data) {
  sum(data - mu) / sigma2
}

info = function(mu, sigma2, data) {
  -n / sigma2
}

# Modified R code from Newton MLE lecture.

newton_mle_norm = function(mu0, sigma2, data, tol = 1e-7, maxiter = 100) {
  mu = mu0
  var_sigma = sigma2
  for (i in 1:maxiter) {
    mu_new = mu - score(mu, var_sigma,  data)/info(mu, var_sigma, data)
    if (abs(mu_new - mu) < tol) {
      return(list(estimate = mu_new, iterations = i))
    }
    mu = mu_new
  }
  stop("Did not converge")
}

# Calling the Newton MLE Normal function.

newton_mle_norm(5, var_nums, norm_nums)
```

```{r}
# Checking result, is it equal to the sample mean?

mean(norm_nums)
```

### Problem 2

```{r}
#(a)

library(readxl)

health_data = read_excel("C:/Users/coryg/Downloads/US_Health_Insurance_Raw.xlsx")

# Taking a peek at the data here.

head(health_data)
```

Data needs to be cleaned. Datatypes for charges have to be changed from characters to numerics and commas need to be removed. Missing values in sex, and outliers have to be handled. Let's take care of this.

```{r}
# Datatypes

library(tidyverse)

health_data = health_data %>% mutate(charges = as.numeric(gsub(",", "", charges)))

head(health_data)
```

```{r}
#(b) Assigning 'male' to all NA's

sex_na = sum(is.na(health_data$sex))
sex_na

health_data = health_data %>% mutate(sex = if_else(is.na(sex), "male", sex))

head(health_data)

```

```{r}
# (c) 

health_data = health_data %>% filter(bmi >= 0 & bmi <= 50)

``` 

```{r}
# (d)

bmi_na = sum(is.na(health_data$bmi))
bmi_na

health_data$bmi[is.na(health_data$bmi)] = mean(health_data$bmi, na.rm = TRUE)

# Row 33 was an NA before, let's check to see if it got imputed.

health_data$bmi[33]
```

```{r}
#(e) Commas already handled, so now we do median imputation for charges.

health_data$charges[is.na(health_data$charges)] = median(health_data$charges, na.rm = TRUE)


```

```{r}
#(f)

x = health_data$charges
Q1 = quantile(x, 0.25, na.rm = TRUE)
Q3 = quantile(x, 0.75, na.rm = TRUE)
IQR = Q3 - Q1

outliers = x < (Q1 - 1.5*IQR) | x > (Q3 + 1.5*IQR)

health_data[outliers, ]
```

Note that if you rerun the above block for part (f) again with the constant changed to 3, we now have reduced the number of outliers detected from 138 to 32. This is the idea of the "threshold" we discussed in class.

```{r}

health_data = health_data %>% mutate(sex_binary = if_else(sex == "male", 1, 0))

head(health_data)
```

```{r}
health_data = health_data %>%
  mutate(smoker_binary = if_else(smoker == "yes", 1, 0))

head(health_data)
```


<br>
